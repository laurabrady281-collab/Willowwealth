<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
    <title>Sign up | WillowWealth</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="preload" href="images/auth/welcome-card-new.png" as="image">
    <style>
        .signup-page {
            background-color: #ffffff;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #002e30;
        }
        .signup-layout {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }
        .signup-main-content {
            display: flex;
            width: 100%;
            align-items: center;
            justify-content: center;
            gap: 80px;
            margin-bottom: 24px;
        }
        .signup-left {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            max-width: 400px;
            padding: 0;
            text-align: center;
        }
        .auth-logo {
            margin-bottom: 32px;
            display: block;
        }
        .auth-logo img {
            height: 32px;
            width: auto;
            max-width: 100%;
        }
        @media (max-width: 480px) {
            .auth-logo img {
                height: 26px;
            }
        }
        .signup-subtitle {
            font-size: 14px;
            color: #002e30;
            margin-bottom: 32px;
            font-weight: 500;
        }
        .social-auth {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            margin-bottom: 16px;
        }
        .btn-social {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 9999px;
            background: white;
            font-size: 14px;
            font-weight: 500;
            color: #002e30;
            cursor: pointer;
            transition: background 0.2s;
            width: 100%;
            text-decoration: none;
            box-sizing: border-box;
        }
        .btn-social:hover {
            background: #f9fafb;
        }
        .auth-divider {
            text-align: center;
            margin: 16px 0;
            position: relative;
            width: 100%;
        }
        .auth-divider::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e5e7eb;
            z-index: 1;
        }
        .auth-divider span {
            position: relative;
            z-index: 2;
            background: #ffffff;
            padding: 0 10px;
            color: #9ca3af;
            font-size: 12px;
        }
        .btn-email-signup {
            width: 100%;
            background: #002E30;
            color: #ffffff;
            border: none;
            padding: 14px;
            border-radius: 9999px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
        }
        .btn-email-signup:hover {
            opacity: 0.9;
        }
        .auth-footer-text {
            font-size: 14px;
            color: #002e30;
            margin-bottom: 0;
        }
        .auth-footer-text a {
            color: #002e30;
            text-decoration: underline;
            font-weight: 600;
        }
        .signup-right {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
        .welcome-card-container {
            width: 100%;
            max-width: 600px;
            display: flex;
            justify-content: center;
            transition: none;
            animation: none;
            opacity: 1;
            transform: none;
        }
        .welcome-card-img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 24px;
            transition: none;
            animation: none;
            opacity: 1;
            transform: none;
        }
        .auth-legal-footer {
            width: 100%;
            max-width: 400px;
            text-align: center;
            padding: 24px 0 40px;
            font-size: 12px;
            color: #4b5563;
            margin-right: auto;
            margin-left: 0;
            line-height: 1.6;
        }
        .auth-legal-footer p {
            margin: 0;
        }
        .auth-legal-footer a {
            color: #4b5563;
            text-decoration: underline;
        }
        .copyright-footer {
            margin-top: 4px;
        }
        @media (max-width: 768px) {
            .signup-main-content {
                flex-direction: column;
                gap: 40px;
            }
            .signup-left {
                max-width: 100%;
                padding: 0 16px;
            }
            .signup-right {
                display: none;
            }
            .auth-legal-footer {
                margin: 0 auto;
            }
        }
        @media (max-width: 480px) {
            .signup-layout {
                padding: 24px 16px;
            }
            .btn-email-signup, .btn-social {
                min-height: 44px;
            }
        }
    </style>
<style>*{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-touch-callout:none}img{pointer-events:none;-webkit-user-drag:none;-khtml-user-drag:none;-moz-user-drag:none;-o-user-drag:none;user-drag:none}input,textarea,select,[contenteditable]{-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}</style>
<script src="/js/protect.js" defer></script>
</head>
<body class="signup-page">
    <div id="page-loader" class="page-loader" style="display:none;opacity:0;visibility:hidden;">
        <div class="loader-content">
            <svg class="loader-w" viewBox="0 0 100 100">
                <path d="M20 30 L40 70 L50 50 L60 70 L80 30" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
        </div>
    </div>
    
    <div class="signup-layout" id="signup-main-screen">
        <div class="signup-main-content">
            <div class="signup-left">
                <a href="index.html" class="auth-logo">
                    <img src="images/auth/logo.svg" alt="WillowWealth">
                </a>
                
                <p class="signup-subtitle">Access curated private market alternatives.</p>
                
                <div class="social-auth">
                    <a href="/auth/google?mode=signup" class="btn-social">
                        <img src="https://www.gstatic.com/images/branding/product/1x/gsa_512dp.png" alt="Google" width="18">
                        Sign up with Google
                    </a>
                    <a href="/auth/apple?mode=signup" class="btn-social">
                        <svg width="18" height="18" viewBox="0 0 384 512"><path fill="currentColor" d="M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 49.9-11.4 69.5-34.3z"/></svg>
                        Sign up with Apple
                    </a>
                </div>
                
                <div class="auth-divider">
                    <span>or</span>
                </div>
                
                <button class="btn-email-signup" id="show-email-signup">Sign up with email</button>
                
                <p class="auth-footer-text">
                    Already have an account? <a href="login.html">Log in</a>
                </p>

                <footer class="auth-legal-footer">
                    <p>This site is protected by reCAPTCHA and the Google <a href="#">Privacy Policy</a> and <a href="#">Terms of Service</a> apply.</p>
                    <p class="copyright-footer">Copyright © 2026 Willow Wealth Inc.</p>
                </footer>
            </div>
            
            <div class="signup-right">
                <div class="welcome-card-container">
                    <img src="images/auth/welcome-card-new.png" alt="Welcome" class="welcome-card-img" loading="eager" fetchpriority="high" decoding="sync">
                </div>
            </div>
        </div>
    </div>

    <!-- Email Signup Screen (hidden by default) -->
    <div class="email-signup-layout" id="email-signup-screen" style="display: none;">
        <header class="email-signup-header">
            <a href="index.html" class="auth-logo" style="margin-bottom: 0;"><img src="images/auth/logo.svg" alt="WillowWealth"></a>
        </header>
        <main class="email-signup-content">
            <h1>Create your account</h1>
            <p class="email-signup-subtitle">Start building a portfolio tailored to your objectives.</p>
            
            <form class="email-signup-form" id="signup-form" novalidate>
                <div class="input-group" data-field="first-name">
                    <label for="first-name">Legal first name</label>
                    <input type="text" id="first-name" placeholder="Legal first name" required autocomplete="given-name">
                    <span class="field-error">This field is required.</span>
                </div>
                <div class="input-group" data-field="last-name">
                    <label for="last-name">Legal last name</label>
                    <input type="text" id="last-name" placeholder="Legal last name" required autocomplete="family-name">
                    <span class="field-error">This field is required.</span>
                </div>
                <div class="input-group" data-field="email">
                    <label for="email">Email address</label>
                    <input type="email" id="email" placeholder="Email address" required autocomplete="email">
                    <span class="field-error">This field is required.</span>
                </div>
                <div class="input-group password-wrapper" data-field="password">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Password" required autocomplete="new-password">
                    <button type="button" class="toggle-password" id="togglePassword">
                        <i class="fa-regular fa-eye"></i>
                    </button>
                    <span class="field-error">This field is required.</span>
                </div>

                <div class="legal-consent">
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="consent" required>
                        <label for="consent">
                            I have read and accepted the <a href="#">Privacy Policy</a>, <a href="#">Terms of Service</a>, <a href="#">Electronic Disclosure and Consent</a>, <a href="#">Limited Brokerage Services Agreement</a> and <a href="#">Form CRS</a> and I consent to the use of electronic records in connection with this application.
                        </label>
                    </div>
                </div>

                <button type="submit" class="btn-continue-email" id="continue-btn" disabled>Continue</button>
            </form>

            <div class="secure-badge">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="M9 12l2 2 4-4"/></svg>
                <p>SECURE<br><span style="font-weight:400;font-size:9px;letter-spacing:0">SSL Encryption</span></p>
            </div>
        </main>
        <footer class="email-signup-footer">
            <p>Copyright © 2026 Willow Wealth Inc.</p>
        </footer>
    </div>
    <script>
        // Screen switching logic
        document.addEventListener('DOMContentLoaded', function() {
            const showEmailSignupBtn = document.getElementById('show-email-signup');
            const signupMainScreen = document.getElementById('signup-main-screen');
            const emailSignupScreen = document.getElementById('email-signup-screen');

            if (showEmailSignupBtn && signupMainScreen && emailSignupScreen) {
                showEmailSignupBtn.addEventListener('click', function() {
                    signupMainScreen.style.display = 'none';
                    emailSignupScreen.style.display = 'flex';
                });
            }
        });
    </script>
    <script>
        (function() {
            var form = document.getElementById('signup-form');
            if (!form) return;

            var inputs = form.querySelectorAll('.input-group input[type="text"], .input-group input[type="email"], .input-group input[type="password"]');
            var consent = document.getElementById('consent');
            var continueBtn = document.getElementById('continue-btn');

            function updateGroup(input) {
                var group = input.closest('.input-group');
                if (input.value.trim().length > 0) {
                    group.classList.add('has-value');
                } else {
                    group.classList.remove('has-value');
                }
            }

            function checkFormValid() {
                var allFilled = true;
                inputs.forEach(function(inp) {
                    if (!inp.value.trim()) allFilled = false;
                });
                if (!consent.checked) allFilled = false;
                continueBtn.disabled = !allFilled;
            }

            inputs.forEach(function(input) {
                input.addEventListener('focus', function() {
                    var group = this.closest('.input-group');
                    group.classList.add('focused');
                    group.classList.remove('error');
                });

                input.addEventListener('blur', function() {
                    var group = this.closest('.input-group');
                    group.classList.remove('focused');
                    updateGroup(this);
                    if (!this.value.trim()) {
                        group.classList.add('error');
                    }
                });

                input.addEventListener('input', function() {
                    var group = this.closest('.input-group');
                    updateGroup(this);
                    if (this.value.trim()) {
                        group.classList.remove('error');
                    }
                    checkFormValid();
                });
            });

            consent.addEventListener('change', checkFormValid);

            var toggleBtn = document.getElementById('togglePassword');
            var pwInput = document.getElementById('password');
            if (toggleBtn && pwInput) {
                toggleBtn.addEventListener('click', function() {
                    var icon = this.querySelector('i');
                    if (pwInput.type === 'password') {
                        pwInput.type = 'text';
                        icon.className = 'fa-regular fa-eye-slash';
                    } else {
                        pwInput.type = 'password';
                        icon.className = 'fa-regular fa-eye';
                    }
                });
            }

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                var hasError = false;
                inputs.forEach(function(inp) {
                    if (!inp.value.trim()) {
                        inp.closest('.input-group').classList.add('error');
                        hasError = true;
                    }
                });
                if (hasError || !consent.checked) return;

                var firstName = document.getElementById('first-name').value;
                var lastName = document.getElementById('last-name').value;
                var email = document.getElementById('email').value;
                var password = document.getElementById('password').value;

                continueBtn.disabled = true;
                continueBtn.textContent = 'Creating account...';

                try {
                    var response = await fetch('/api/signup', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ firstName: firstName, lastName: lastName, email: email, password: password })
                    });
                    var result = await response.json();
                    if (result.success) {
                        window.location.href = result.redirect || '/legal-name.html';
                    } else {
                        var errorText = result.error || 'Something went wrong. Please try again.';
                        var toast = document.createElement('div');
                        toast.textContent = errorText;
                        toast.style.cssText = 'position:fixed;top:24px;left:50%;transform:translateX(-50%);background:#dc2626;color:#fff;padding:12px 24px;border-radius:12px;font-size:14px;font-family:Inter,sans-serif;z-index:10000;box-shadow:0 4px 12px rgba(0,0,0,0.15);';
                        document.body.appendChild(toast);
                        setTimeout(function() { toast.remove(); }, 5000);
                        continueBtn.disabled = false;
                        continueBtn.textContent = 'Continue';
                    }
                } catch (error) {
                    var toast = document.createElement('div');
                    toast.textContent = 'An error occurred. Please try again.';
                    toast.style.cssText = 'position:fixed;top:24px;left:50%;transform:translateX(-50%);background:#dc2626;color:#fff;padding:12px 24px;border-radius:12px;font-size:14px;font-family:Inter,sans-serif;z-index:10000;box-shadow:0 4px 12px rgba(0,0,0,0.15);';
                    document.body.appendChild(toast);
                    setTimeout(function() { toast.remove(); }, 5000);
                    continueBtn.disabled = false;
                    continueBtn.textContent = 'Continue';
                }
            });
        })();
    </script>
    <script>
        (function() {
            document.addEventListener('DOMContentLoaded', function() {
                var googleBtn = document.querySelector('a[href*="/auth/google"]');
                if (googleBtn) {
                    googleBtn.addEventListener('click', function(e) {
                        console.log('[OAuth Debug] Google auth URL:', window.location.origin + googleBtn.getAttribute('href'));
                        console.log('[OAuth Debug] Expected redirect_uri:', window.location.origin + '/auth/google/callback');
                    });
                }
            });

            const params = new URLSearchParams(window.location.search);
            const error = params.get('error');
            if (error) {
                const messages = {
                    'apple_not_configured': 'Apple Sign-In is not available right now. Please try again later.',
                    'google_not_configured': 'Google Sign-In is not available right now. Please try again later.',
                    'auth_cancelled': 'Sign-up was cancelled.',
                    'invalid_state': 'Something went wrong. Please try again.',
                    'token_exchange_failed': 'Authentication failed. Please try again.',
                    'userinfo_failed': 'Could not retrieve your account info. Please try again.',
                    'auth_failed': 'Authentication failed. Please try again.'
                };
                const msg = messages[error] || 'An error occurred. Please try again.';
                const toast = document.createElement('div');
                toast.textContent = msg;
                toast.style.cssText = 'position:fixed;top:24px;left:50%;transform:translateX(-50%);background:#013536;color:#fff;padding:12px 24px;border-radius:12px;font-size:14px;font-family:Inter,sans-serif;z-index:10000;box-shadow:0 4px 12px rgba(0,0,0,0.15);';
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 5000);
                window.history.replaceState({}, '', window.location.pathname);
            }
        })();
    </script>
    <script>
        document.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', function(e) {
                const href = this.getAttribute('href');
                const target = this.getAttribute('target');

                if (href && 
                    !href.startsWith('#') && 
                    !href.startsWith('javascript') && 
                    target !== '_blank') {
                    
                    const loader = document.getElementById('page-loader');
                    if (loader) {
                        loader.style.display = 'flex';
                        setTimeout(() => {
                            loader.classList.add('active');
                        }, 10);
                    }
                }
            });
        });
    </script>
    <script>
      window.intercomSettings = {
        api_base: "https://api-iam.intercom.io",
        app_id: "ub97p16r",
      };
    </script>

    <script>
      // We pre-fill the query objects with some defaults
      (function () {
        var w = window;
        var ic = w.Intercom;
        if (typeof ic === "function") {
          ic("reattach_activator");
          ic("update", w.intercomSettings);
        } else {
          var d = document;
          var i = function () {
            i.c(arguments);
          };
          i.q = [];
          i.c = function (args) {
            i.q.push(args);
          };
          w.Intercom = i;
          var l = function () {
            var s = d.createElement("script");
            s.type = "text/javascript";
            s.async = true;
            s.src = "https://widget.intercom.io/widget/ub97p16r";
            var x = d.getElementsByTagName("script")[0];
            x.parentNode.insertBefore(s, x);
          };
          if (document.readyState === "complete") {
            l();
          } else if (w.attachEvent) {
            w.attachEvent("onload", l);
          } else {
            w.addEventListener("load", l, false);
          }
        }
      })();
    </script>
</body>
</html>